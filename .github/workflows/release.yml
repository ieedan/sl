name: Release Go Binaries

on:
    release:
        types: [created]

jobs:
    releases-matrix:
        name: Release Go Binary
        runs-on: ubuntu-latest
        strategy:
            matrix:
                goos: [linux, windows, darwin]
                goarch: ["386", amd64, arm64]
                exclude:
                    - goarch: "386"
                      goos: darwin
                    - goarch: arm64
                      goos: windows
        steps:
            - uses: actions/checkout@v4

            - name: Install C dependencies
              run: |
                sudo apt-get update
                sudo apt-get install -y build-essential gcc libc6-dev

            - name: Compile And Add Binaries To Release
              uses: wangyoucao577/go-release-action@v1
              with:
                  github_token: ${{ secrets.GITHUB_TOKEN }}
                  goos: ${{ matrix.goos }}
                  goarch: ${{ matrix.goarch }}
                  goversion: "https://dl.google.com/go/go1.23.1.linux-amd64.tar.gz"
                  project_path: "."
                  binary_name: "sl"
                  extra_files: LICENSE README.md migration.sql
              env:
                  CGO_ENABLED: 1
